<% layout('layout') -%>
<div class="feed">
  <% posts.forEach(post => { %>
    <div class="post">
      <img src="<%= post.image %>" alt="post">
      <p><strong><%= post.author ? post.author.username : 'Anonymous' %></strong></p>
      <p><%= post.caption || '' %></p>
      <p>‚ù§ <%= post.likes.length %> likes</p>
      
      <% if (user) { %>
        <form action="/post/<%= post._id %>/like" method="POST" style="display:inline">
          <button><%= post.likes.includes(user.id) ? 'Unlike' : 'Like' %></button>
        </form>
        <% if (post.author && post.author._id.toString() === user.id) { %>
          <form action="/post/<%= post._id %>/delete" method="POST" style="display:inline">
            <button onclick="return confirm('Delete?')">Delete</button>
          </form>
        <% } %>
      <% } %>
    </div>
  <% }) %>
</div>