<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram Clone - Post Detail</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="main-container">
        <%- include('partials/navbar') %>
       
        <div class="content">
            <div class="post-detail-container">
                <!-- Post main content -->
                <div class="post-main">
                    <!-- Images -->
                    <div class="post-images-large">
                        <% if (post.images && post.images.length > 0) { %>
                            <% post.images.forEach((img) => { %>
                                <img src="<%= img %>" alt="Post image" class="post-img">
                            <% }); %>
                        <% } %>
                    </div>
                   
                    <!-- Post information -->
                    <div class="post-info">
                        <div class="post-header">
                            <img src="<%= post.userId.profileImage || '/images/default-avatar.jpg' %>" 
                                 class="avatar" alt="<%= post.userId.username %>'s avatar">
                            <p class="username"><%= post.userId.username %></p>
                        </div>
                       
                        <p class="content"><%= post.content %></p>
                       
                        <!-- Tags -->
                        <% if (post.tags && post.tags.length > 0) { %>
                            <div class="tags">
                                <% post.tags.forEach((tag) => { %>
                                    <a href="/search?q=%23<%= tag %>" class="tag">#<%= tag %></a>
                                <% }); %>
                            </div>
                        <% } %>
                       
                        <!-- Like section -->
                        <div class="like-section">
                            <button onclick="likePost('<%= post._id %>')" class="like-btn">
                                Like (<span id="likeCount"><%= post.likeCount || 0 %></span>)
                            </button>
                        </div>
                       
                        <!-- Delete button (owner only) -->
                        <% if (isOwner) { %>
                            <button onclick="deletePost('<%= post._id %>')" class="delete-btn">
                                Delete Post
                            </button>
                        <% } %>
                    </div>
                </div>
               
                <!-- Comments section -->
                <div class="comments-section">
                    <%- include('partials/comment-section', { postId: post._id, comments: comments }) %>
                </div>
            </div>
        </div>
    </div>
   
    <script>
        function likePost(postId) {
            fetch(`/api/posts/${postId}/like`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('likeCount').innerText = data.likeCount;
                    alert('Liked!');
                } else {
                    alert('Error: ' + (data.message || 'Could not like the post'));
                }
            })
            .catch(err => {
                console.error(err);
                alert('Network error. Please try again.');
            });
        }
       
        function deletePost(postId) {
            if (confirm('Are you sure you want to delete this post? This action cannot be undone.')) {
                fetch(`/api/posts/${postId}`, { 
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' }
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert('Post deleted successfully');
                        window.location.href = '/home';
                    } else {
                        alert('Error: ' + (data.message || 'Failed to delete post'));
                    }
                })
                .catch(err => {
                    console.error(err);
                    alert('Network error. Please try again.');
                });
            }
        }
    </script>
</body>
</html>
