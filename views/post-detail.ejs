<!DOCTYPE html>
<html>
<head>
    <title>Instagram Clone - Post Detail</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="main-container">
        <%- include('partials/navbar') %>
        
        <div class="content">
            <div class="post-detail-container">
                <!-- Â∏ñÂ≠ê‰∏ª‰Ωì -->
                <div class="post-main">
                    <!-- ÂõæÁâá -->
                    <div class="post-images-large">
                        <% if (post.images && post.images.length > 0) { %>
                            <% post.images.forEach((img) => { %>
                                <img src="<%= img %>" alt="post image" class="post-img">
                            <% }); %>
                        <% } %>
                    </div>
                    
                    <!-- Â∏ñÂ≠ê‰ø°ÊÅØ -->
                    <div class="post-info">
                        <div class="post-header">
                            <img src="<%= post.userId.profileImage %>" class="avatar" alt="avatar">
                            <p class="username"><%= post.userId.username %></p>
                        </div>
                        
                        <p class="content"><%= post.content %></p>
                        
                        <!-- Ê†áÁ≠æ -->
                        <% if (post.tags && post.tags.length > 0) { %>
                            <div class="tags">
                                <% post.tags.forEach((tag) => { %>
                                    <a href="/search?q=%23<%= tag %>" class="tag">#<%= tag %></a>
                                <% }); %>
                            </div>
                        <% } %>
                        
                        <!-- ÁÇπËµûÂå∫ -->
                        <div class="like-section">
                            <button onclick="likePost('<%= post._id %>')" class="like-btn">
                                ‚ù§Ô∏è Like (<span id="likeCount"><%= post.likeCount %></span>)
                            </button>
                        </div>
                        
                        <!-- Âà†Èô§ÊåâÈíÆÔºà‰ªÖÊâÄÊúâËÄÖÔºâ -->
                        <% if (isOwner) { %>
                            <button onclick="deletePost('<%= post._id %>')" class="delete-btn">
                                üóëÔ∏è Delete Post
                            </button>
                        <% } %>
                    </div>
                </div>
                
                <!-- ËØÑËÆ∫Âå∫ -->
                <div class="comments-section">
                    <%- include('partials/comment-section', { postId: post._id, comments: comments }) %>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        function likePost(postId) {
            fetch(`/api/posts/${postId}/like`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('likeCount').innerText = data.likeCount;
                    alert('‚ù§Ô∏è Liked!');
                }
            })
            .catch(err => alert('Error: ' + err));
        }
        
        function deletePost(postId) {
            if (confirm('Are you sure you want to delete this post?')) {
                fetch(`/api/posts/${postId}`, { method: 'DELETE' })
                    .then(res => res.json())
                    .then(data => {
                        if (data.success) {
                            alert('‚úÖ Post deleted');
                            window.location.href = '/home';
                        }
                    })
                    .catch(err => alert('Error: ' + err));
            }
        }
    </script>
</body>
</html>
